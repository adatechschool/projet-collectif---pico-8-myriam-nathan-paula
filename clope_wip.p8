pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- init, update, draw

function _init()

	p={
		x=24, 
		y=24,
		sprite=1,
		flp=false,
		dx=0, dy=0,
		max_dx=2, max_dy=3,
		speed=0.5,
		w=8 , h=8,
		dir="right",
		
		boost=4,
		anim=0,
		
		running=false,
		jumping=false,
		falling=false,
		sliding=false,
		landed=false,	
 }
 
 	gravity=0.3
 	friction=0.85
 	
 	--simple camera
 	cam_x=0
 	
 	--map limits
 	map_start=0
 	map_end=256
end


function _update()

player_update()
player_animate()
--update_camera()

--simple camera
	cam_x=p.x-64+(p.w/2)
	if cam_x<map_start then
	   cam_x=map_start
	end
	if cam_x>map_end-128 then
	   cam_x=map_end-128
	end
	camera(cam_x,0)
end



function _draw()

cls(1)
map(0,0)
spr(p.sprite,p.x,p.y,1,1,p.flp)


end


-->8
-- map

--function draw_map()
--	map(0,0,0,0,33,18)
--end
	
-- camera

--function update_camera()
--	local camx=mid(0,p.x-7.5,32-15)
--	local camy=mid (0,p.y-7.5,18-15)
--	camera(camx*8,camy*8)
--	end


-->8
-- les fonctions 

--function draw_player()
	
--end
	
function player_update()

p.dy+=gravity
p.dx*=friction

 if (btn(⬅️)) then
  p.dx-=p.speed
  p.running=true
  p.flp=true
 end
 
	
	if (btn(➡️)) then
	 p.dx+=p.speed 
	 p.running=true
	 p.flp=false
	end 

-- slide	
	if p.running
	and not btn(⬅️)
	and not btn(➡️)
	and not p.falling
	and not p.jumping then
	  p.running=false
	  p.sliding=true
	end 
	 
 if btnp(❎)
 and p.landed then
 p.dy-=p.boost
 p.landed=false
 end
	 
--check collision up and down
 if p.dy>0 then
 		p.falling=true
 		p.landed=false
 		p.jumping=false
 		
 		p.dy=limit_speed(p.dy,p.max_dy)  

   if collide_map(p,"down",0) then
     p.landed=true
     p.falling=false
     p.dy=0
     p.y-=((p.y+p.h+1)%8)-1
   end
   
 elseif p.dy<0 then
 		p.jumping=true
 	 if collide_map(p,"up",1) then
 		  p.dy=0 
			end
	end
		
--check collision left and right
	if p.dx<0 then

   p.dx=limit_speed(p.dx,p.max_dx)

 		if collide_map(p,"left",1) then
      p.dx=0
   end
 elseif p.dx>0 then

   p.dx=limit_speed(p.dx,p.max_dx)

   if collide_map(p,"right",1) then
      p.dx=0
   end
 end

--stop sliding
 
 if p.sliding then
   if abs(p.dx)<.2
   or p.running then
      p.dx=0
      p.sliding=false
   end
 end

 p.x+=p.dx
 p.y+=p.dy

--limit player to map
	
	if p.x<map_start then
		p.px=map_start 
	end
	if p.x>map_end-p.w then
		p.px=map_end-p.w 
	end

end





			

-->8
-- collisions

function collide_map(obj,aim,flag)
		local x=obj.x local y=obj.y
		local w=obj.w local h=obj.h

		local x1=0 local y1=0
		local w1=0 local h1=0

		if aim=="left" then
			x1=x-1 		y1=y
			x2=x					y2=y+h-1
			
		elseif aim=="right" then
			x1=x+w			y1=y
			x2=x					y2=y+h-1
			
		elseif aim=="up" then
			x1=x+1			y1=y-1
			x2=x+w-1	y2=y
			
		elseif aim=="down" then 
			x1=x					y1=y+h
			x2=x+w			y2=y+h
			
		end
--pixels to tiles
x1/=8		y1/=8		
x2/=8		y2/=8

if fget(mget(x1,y1),flag)
or fget(mget(x2,y2),flag)
or fget(mget(x1,y2),flag)
or fget(mget(x2,y1),flag) then
		return true
else
		return false
		end
	
end
		


-->8
--limit speed
function limit_speed(num,maximum)
	return mid(-maximum,num,maximum)
end
	
-->8
--player animation
function player_animate()
	if p.jumping then
			p.sp=7
	elseif p.falling then
			p.sp=8
	elseif p.sliding then
			p.sp=9

	elseif p.running then
			if time()-p.anim>.1 then
					p.anim=time()
					p.sp+=1
					if p.sp>6 then
							p.sp=3 
					end
			end
			
	else
			if time()-p.	anim>.3 then
					p.anim=time()
					p.sp+=1
					if p.sp>2 then
							p.sp=1 
					end
			end
	end
end
__gfx__
00000000000000600000000600000006000000600000000600000060000000060000006000000006000000000000000011111111111111110000000000000000
00000000000000060000006000000060000000060000006000000006000000600000000600000060000000000000000011111111111111110000000000000000
0070070000000060000000060000000600000060000000060000006000000006000000600000000600000000000000001111111111a111110000000000000000
00077000447777904477779044777790447777904477779044777790447777904477779044777790000000000000000011116766111911110000000000000000
00077000008800000088000000880000008800000088000000880000008800000088000000880000000000000000000011167777611111110000000000000000
00700700080800000808000048080000008000004808000000800000080800000080000000800000000000000000000011116776111111110000000000000000
00000000080080000800800040800000080000004008000008000000480800000008800000088000000000000000000011111611116676110000000000000000
00000000044044000440440000440000044000000004400004400000400440000000440000004400000000000000000011111111167777610000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111116776110000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111116111161110000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111167661111110000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111116777761111a0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111167761111910000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a111111111111110000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011911111111111110000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111110000000000000000
b33b33b333b3333b0000000011111111111111111111111111111111000000600000000000000060000000066000000006000000044777790977774400000000
3b3b33b3b3343b330555555011111111111111111111111111111111000000060000000000000006000000600600000060000000000880000008800000000000
33b333b343444346a444444a11111111111111111111111111111111000000600000000000000060000000066000000006000000048080000008084000000000
33b3b33b4b5644655444444511111111111111111111111111111111447777900000000044777790447777900977774409777744040080000008004000000000
b3b33b3b04654654554aa45511111111111111111111111111111111000000000000000000880000008800000000880000008800600044000044000600000000
33b3333b04064040545555451111111111111111111aaa1111111111000000000000000008080000080800000000808000008080006006000060060000000000
3b333b33000400005444444511111111111111111aaa511111111111000000000000000008008000080080000008008000080080060060000006006000000000
3b33b333000000005444444511111111111111111aaa111111111111000000000000000004404400044044000044044000440440000600000000600000000000
131b13b133b3333b111111111111111111111111aaaa111111111111000000060000000000006767000067760006760000007000000000000000000000000000
3b3b33b3b3343b331555555111a11111111a11115aaaa11111111111000000600000000000000677000067600000600000060000000000000000000000000000
33b333b343444346a444444a1119111111911111aaaaa11a11111111000000060000000000000066000006000000060000006000000600000000000000000000
33b3b33b4b5644655444444511111111111111111aaaaaa511111111447777900000000044777790447779004477900044790000449000000000000000000000
b3b33b3b14654654554aa455111111111111111115aaaa5111111111000000000000000000000000000000000000000000000000000000000000000000000000
33b3333b1416414154555545119111a119111a11115a151111111111000000000000000000000000000000000000000000000000000000000000000000000000
3b333b3311141111544444451a11191111a111911111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
3b33b333111111115444444511111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000677600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006777600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000677600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000044477777779600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000044477777779000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000033300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000300030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004400044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2333233325262323332323233323232324242424242424242424242424242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3323232335362323232333232323313126262626262626262626332626262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2323233323233323332323232333232326262633262626262626262632262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3323232323332323233131332323233326262626263326262626263131312624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2323332323232323232323232323322326262626262626262626262626262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2323233131312333232333232331313126262626262626313126262626332624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2333232323332323313131233323232326262633262626262626262626262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2323232333232323232323232323332326262626262626262626263131262424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3131313131313131313131313131242426262626262633262626262626262424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262633262626242424262626262631313126262626262626262626262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262626262626242626262626262626262626262626263131262626262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262626262626262626262631312626262626262626262626262626262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626332626262626263131262626262626263326262626262626263131262624240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262626262626262626262626262626262626262626262626262626262623230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262626313131262626262626262626262626262631312626262633262623240f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262626262626262633262626332626262626262626262626262623262623230f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3326262626262626262626262626262626262626262626262626262626262623230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3030303030303030303030303030303030303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000f00000a05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
